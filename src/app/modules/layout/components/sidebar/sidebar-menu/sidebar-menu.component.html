<div *ngFor="let menu of menuService.pagesMenu">
  <!-- Grupo -->
  <div *ngIf="menuService.showSideBar" class="mx-2 flex items-center justify-between py-2">
    <small class="text-muted-foreground/50 text-[11px] font-semibold uppercase tracking-wide">
      {{ menu.group }}
    </small>
  </div>

  <ul class="flex flex-col text-xs">
    <li *ngFor="let item of menu.items">
      <div
        (click)="toggleMenu(item)"
        [ngClass]="{
          'hover:bg-primary/10': !menuService.showSideBar && item.active,
          'hover:bg-muted/20': !menuService.showSideBar
        }"
        class="group relative flex grow items-center gap-3 rounded-md px-2 py-1 cursor-pointer transition-all"
      >
        <!-- Ícono -->
        <div
          [ngClass]="item.active && !menuService.showSideBar ? 'text-primary' : 'text-muted-foreground/50'"
        >
          <svg-icon src="{{ item.icon }}" [svgClass]="'h-5 w-5'"> </svg-icon>
        </div>

        <!-- Template dinámico -->
        <ng-container
          [ngTemplateOutlet]="item.children ? childMenu : parentMenu"
          [ngTemplateOutletContext]="{ item: item }"
        ></ng-container>

        <!-- Flecha para expandir -->
        <button
          *ngIf="item.children"
          [ngClass]="{ hidden: !menuService.showSideBar }"
          class="ml-auto text-muted-foreground transition-transform duration-300 text-xs"
        >
          <svg-icon
            [src]="item.expanded
              ? 'assets/icons/heroicons/outline/minus.svg'
              : 'assets/icons/heroicons/outline/plus.svg'"
            svgClass="h-4 w-4"
          ></svg-icon>
        </button>

        <!-- Tooltip (si sidebar oculto) -->
        <div *ngIf="!menuService.showSideBar" class="absolute left-full ml-2 z-20">
          <span
            class="invisible group-hover:visible whitespace-nowrap bg-foreground text-background rounded px-2 py-1 text-[10px] font-bold shadow transition-all duration-150 opacity-0 group-hover:opacity-100"
          >
            {{ item.label }}
          </span>
        </div>
      </div>

      <!-- Submenú (se mantiene tu componente) -->
      <app-sidebar-submenu [submenu]="item"></app-sidebar-submenu>
    </li>
  </ul>

  <!-- Separador si aplica -->
  <div class="py-2" *ngIf="menu.separator">
    <hr class="border-muted-foreground/20 border-dashed" />
  </div>
</div>

<!-- Templates -->
<ng-template #parentMenu let-item="item">
  <div
    routerLink="{{ item.route }}"
    class="text-muted-foreground hover:text-primary flex h-[36px] items-center"
  >
    <a
      [ngClass]="{ hidden: !menuService.showSideBar }"
      routerLinkActive="text-primary"
      class="truncate text-xs font-semibold focus:outline-none"
    >
      {{ item.label }}
    </a>
  </div>
</ng-template>

<ng-template #childMenu let-item="item">
  <div class="flex h-9 items-center">
    <a
      [ngClass]="{ hidden: !menuService.showSideBar }"
      class="text-muted-foreground group-hover:text-primary truncate text-xs font-semibold"
    >
      {{ item.label }}
    </a>
  </div>
</ng-template>
