<!-- CONTENEDOR PRINCIPAL -->
<div class=" bg-gray-50 flex flex-col">
    <div class="container mx-auto px-4 py-4 flex-grow flex flex-col">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 flex-grow">


            <!-- PRODUCTOS -->
            <div class="col-span-2 flex flex-col space-y-3 overflow-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Columna 1: Cliente -->
                    <div>
                        <h2 class="text-lg font-semibold text-primary">Cliente</h2>
                        <input type="text" placeholder="Ingrese el numero de Cedula o RUC"
                            [(ngModel)]="selectedCustomerId" class="w-full rounded border px-3 py-1 text-xs" />
                        <!-- <select [(ngModel)]="selectedCustomerId" class="w-full border rounded px-2 py-1 text-xs">
                            <option *ngFor="let customer of customers" [value]="customer.id">
                                {{ customer.fullName + ' - ' + customer.identification }}
                            </option>
                        </select> -->
                        <!-- <ng-select [items]="customers" bindLabel="fullName" bindValue="id"
                            [(ngModel)]="selectedCustomerId" [searchable]="true" placeholder="Selecciona un cliente"
                            class="custom-ng-select text-xs w-full">

                        </ng-select> -->



                    </div>

                    <!-- Columna 2: Otro contenido -->
                    <div>
                        <div class="flex gap-2 mt-6">

                            <button (click)="showCustomerModal = true"
                                class="bg-primary text-white rounded-md px-2 py-1 font-semibold">
                                <fa-icon icon="search"></fa-icon> Buscar
                            </button>
                            <button class="bg-primary text-white rounded-md px-2 py-1 font-semibold">
                                Consumidor Final
                            </button>
                        </div>
                    </div>
                </div>

                <h2 class="text-lg font-semibold text-primary">Productos</h2>
                <input type="text" placeholder="Buscar productos..." [(ngModel)]="searchTerm"
                    class="w-1/2 rounded border px-3 py-1 text-xs" />


                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <div *ngFor="let product of filteredProducts()" (click)="addProduct(product)"
                        class="cursor-pointer rounded border p-2 shadow-sm hover:bg-muted transition text-xs">
                        <h3 class="font-medium">{{ product.name }}</h3>
                        <p class="text-muted-foreground">${{ product.price | number: '1.2-2' }}</p>
                    </div>
                </div>
            </div>

            <!-- RESUMEN DEL PEDIDO -->
            <div class="flex flex-col space-y-3 h-full overflow-auto text-xs">
                <h2 class="text-lg font-semibold text-primary">Resumen</h2>

                <ng-container *ngIf="cart.length > 0; else emptyCart">
                    <div class="flex-grow overflow-auto space-y-1">
                        <div *ngFor="let item of cart" class="flex justify-between items-center border-b py-2">
                            <span class="font-medium">
                                {{ item.name }} <span class="text-gray-500 font-normal">x{{ item.quantity }}</span>
                            </span>
                            <div class="flex items-center gap-2">
                                <button (click)="decrease(item)"
                                    class="w-6 h-6 rounded-full border text-gray-600 hover:bg-gray-100 flex items-center justify-center"
                                    title="Disminuir cantidad">
                                    <fa-icon icon="minus"></fa-icon>
                                </button>
                                <span class="w-5 text-center font-semibold">{{ item.quantity }}</span>
                                <button (click)="increase(item)"
                                    class="w-6 h-6 rounded-full border text-gray-600 hover:bg-gray-100 flex items-center justify-center"
                                    title="Aumentar cantidad">
                                    <fa-icon icon="plus"></fa-icon>
                                </button>
                                {{item.total}}
                                <strong class="ml-2 text-gray-900">${{ item.total | number: '1.2-2' }}</strong>
                            </div>
                        </div>
                    </div>



                    <!-- MÉTODO DE PAGO -->
                    <div>

                        <h2 class="text-lg font-semibold text-primary">Método de Pago</h2>
                        <select [(ngModel)]="paymentMethod" class="w-full border rounded px-2 py-1 text-xs">
                            <option value="efectivo">Efectivo</option>
                            <option value="transferencia">Transferencia</option>
                        </select>
                    </div>

                    <!-- TOTALES -->
                    <div class="border-t pt-2 space-y-1 text-xs">
                        <p>Subtotal: ${{ subtotal | number: '1.2-2' }}</p>
                        <p>IVA (12%): ${{ iva | number: '1.2-2' }}</p>
                        <p class="text-base font-bold">Total: ${{ total | number: '1.2-2' }}</p>
                    </div>


                    <!-- BOTONES -->
                    <div class="space-y-2">
                        <button (click)="finalizarVenta()" [disabled]="cart.length === 0 || !selectedCustomerId"
                            class="w-full rounded bg-primary px-4 py-2 text-white font-semibold hover:bg-primary/90 text-sm">
                            Facturar
                        </button>
                        <button (click)="finalizarVenta()" [disabled]="cart.length === 0 || !selectedCustomerId"
                            class="w-full rounded bg-primary px-4 py-2 text-white font-semibold hover:bg-primary/90 text-sm">
                            Nota de Venta
                        </button>
                    </div>
                </ng-container>

                <ng-template #emptyCart>
                    <p class="text-xs text-muted-foreground">Aún no hay productos en la venta.</p>
                </ng-template>

            </div>

        </div>
    </div>
</div>

<!-- MODAL DE NUEVO CLIENTE -->
<div *ngIf="showCustomerModal" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50">
    <div class="bg-white w-full max-w-md rounded shadow-lg p-4 text-xs relative">
        <button class="absolute top-2 right-3 text-lg" (click)="showCustomerModal = false">×</button>
        <h3 class="text-base font-semibold mb-2">Nuevo Cliente</h3>

        <form (ngSubmit)="crearCliente()" class="space-y-2">
            <div>
                <label class="block font-medium">Nombre / Razón Social</label>
                <input type="text" [(ngModel)]="nuevoCliente.fullName" name="fullName"
                    class="w-full border rounded px-2 py-1" required />
            </div>
            <div>
                <label class="block font-medium">Identificación</label>
                <input type="text" [(ngModel)]="nuevoCliente.identification" name="identification"
                    class="w-full border rounded px-2 py-1" required />
            </div>
            <div>
                <label class="block font-medium">Tipo</label>
                <select [(ngModel)]="nuevoCliente.type" name="type" class="w-full border rounded px-2 py-1" required>
                    <option value="final">Consumidor Final</option>
                    <option value="cedula">Cédula</option>
                    <option value="ruc">RUC</option>
                </select>
            </div>
            <div>
                <label class="block font-medium">Email</label>
                <input type="email" [(ngModel)]="nuevoCliente.email" name="email"
                    class="w-full border rounded px-2 py-1" />
            </div>
            <div>
                <label class="block font-medium">Teléfono</label>
                <input type="text" [(ngModel)]="nuevoCliente.phone" name="phone"
                    class="w-full border rounded px-2 py-1" />
            </div>
            <div class="pt-2">
                <button type="submit" class="bg-primary text-white px-4 py-2 rounded w-full font-semibold text-sm">
                    Guardar Cliente
                </button>
            </div>
        </form>
    </div>
</div>