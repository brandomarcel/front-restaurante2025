<div class="flex flex-col">

  <!-- Header -->
  <div class="app-page-header">
    <div>
      <h2 class="app-page-title">Categor√≠as</h2>
      <div class="app-page-subtle space-x-1">
        <span># Registros:</span>
        <span class="text-foreground font-semibold">{{ categoriesFiltradasList.length }}</span>
      </div>
    </div>

    <button class="btn btn-primary" (click)="abrirModal()">
      + Nueva Categor√≠a
    </button>
  </div>

  <!-- Filtros -->
  <div class="toolbar">
    <div class="flex flex-col sm:flex-row gap-2 w-full">
      <input class="input" type="text" [(ngModel)]="searchTerm" placeholder="Buscar por nombre o descripci√≥n..." />

      <select class="select" [(ngModel)]="estadoFiltro" (ngModelChange)="actualizarCategoriasFiltradas()">
        <option value="">Todos</option>
        <option value="activos">Activos</option>
        <option value="inactivos">Inactivos</option>
      </select>
    </div>




    <div class="flex gap-2">

      <app-button (click)="limpiarFiltros()" full impact="bold" tone="light" shape="rounded" size="small">
        Limpiar
      </app-button>
    </div>

  </div>

  <!-- Tabla -->
  <ng-container *ngIf="categoriesFiltradasList.length; else emptyCategorias">
    <div class="app-table-wrap">
      <table class="app-table">
        <thead class="app-thead">
          <tr>
            <th class="app-th">Nombre</th>
            <th class="app-th">Descripci√≥n</th>
            <th class="app-th">Estado</th>
            <th class="app-th last:text-center">Acciones</th>

          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let categoria of categoriesFiltradasList | paginate: { itemsPerPage: pageSize, currentPage: page }; trackBy: trackByName"
            class="app-tr">
            <td class="app-td">{{ categoria.nombre }}</td>
            <td class="app-td">{{ categoria.description || '‚Äî' }}</td>
            <td class="app-td ">
              <span class="badge" [ngClass]="{ 'badge-green': categoria.isactive, 'badge-red': !categoria.isactive }">
                {{ categoria.isactive ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="app-td text-center">
              <div class="inline-flex gap-2 ">
                <button class="btn btn-outline" (click)="abrirModal(categoria)">‚úèÔ∏è Editar</button>
                <button class="btn btn-warn" (click)="eliminar(categoria.name)">üóëÔ∏è Eliminar</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Paginaci√≥n (ngx-pagination) -->
      <div class="pager">
        <button class="pager-btn" (click)="page = page - 1" [disabled]="page === 1">¬´ Anterior</button>
        <span class="text-sm">P√°gina {{ page }}</span>
        <button class="pager-btn" (click)="page = page + 1"
          [disabled]="(categoriesFiltradasList.length || 0) <= (page * pageSize)">
          Siguiente ¬ª
        </button>
      </div>
    </div>
  </ng-container>

  <ng-template #emptyCategorias>
    <div class="app-card">
      <div class="app-card-body text-center text-gray-500">No hay categor√≠as para mostrar.</div>
    </div>
  </ng-template>

  <!-- MODAL CREAR / EDITAR -->
  <div *ngIf="mostrarModal" class="app-modal-backdrop">
    <div class="app-modal">
      <button class="app-modal-close" (click)="cerrarModal()">√ó</button>

      <div class="app-card-body">
        <h3 class="text-lg font-semibold mb-4">
          {{ categoriaEditando ? 'Editar Categor√≠a' : 'Nueva Categor√≠a' }}
        </h3>

        <form [formGroup]="categoriaForm" (ngSubmit)="guardarCategoria()" class="grid gap-4 text-sm">
          <div>
            <label class="block mb-1 font-medium">Nombre</label>
            <input class="input" formControlName="nombre" />
            <p *ngIf="f['nombre'].touched && f['nombre'].invalid" class="text-red-600 text-xs mt-1">Nombre requerido.
            </p>
          </div>

          <div>
            <label class="block mb-1 font-medium">Descripci√≥n</label>
            <input class="input" formControlName="description" />
          </div>

          <div class="flex items-center gap-2">
            <input id="isActive" type="checkbox" formControlName="isActive" />
            <label for="isActive">Activo</label>
          </div>

          <div class="flex justify-end gap-2 pt-2">
            <button type="button" class="btn btn-outline" (click)="cerrarModal()">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>

    </div>
  </div>

</div>