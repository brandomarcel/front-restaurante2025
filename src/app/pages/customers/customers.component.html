<div class="flex flex-col">

    <!-- Header -->
    <div class="app-page-header">
        <div>
            <h2 class="app-page-title">Clientes</h2>
            <div class="app-page-subtle space-x-1">
                <span># Registros:</span>
                <span class="text-foreground font-semibold">{{ filteredCustomersList.length }}</span>
            </div>
        </div>

        <button class="btn btn-primary" (click)="abrirModal()">
            + Nuevo Cliente
        </button>
    </div>

    <!-- Filtros -->
    <div class="toolbar">
        <input class="input" type="text" [(ngModel)]="searchTerm" placeholder="Buscar por nombre o identificaci√≥n..." />
        <div class="flex gap-2">
            <app-button (click)="_searchTerm=''; filtrarClientes()" full impact="bold" tone="light" shape="rounded"
                size="small">
                Limpiar
            </app-button>


        </div>
    </div>

    <!-- Tabla -->
    <ng-container *ngIf="filteredCustomersList.length; else emptyCustomers">
        <div class="app-table-wrap">
            <table class="app-table">
                <thead class="app-thead">
                    <tr>
                        <th class="app-th">Nombre</th>
                        <th class="app-th">Identificaci√≥n</th>
                        <th class="app-th">Tel√©fono</th>
                        <th class="app-th">Email</th>
                        <th class="app-th">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let customer of filteredCustomersList | paginate: { itemsPerPage: pageSize, currentPage: page }; trackBy: trackById"
                        class="app-tr">
                        <td class="app-td">{{ customer.nombre }}</td>
                        <td class="app-td">{{ customer.num_identificacion }}</td>
                        <td class="app-td">{{ customer.telefono || '‚Äî' }}</td>
                        <td class="app-td">{{ customer.correo || '‚Äî' }}</td>
                        <td class="app-td">
                            <div class="flex gap-2">
                                <button class="btn btn-outline" (click)="abrirModal(customer)">‚úèÔ∏è Editar</button>
                                <button class="btn btn-warn" (click)="delete(customer.name)">üóëÔ∏è Eliminar</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Paginaci√≥n -->
            <div class="pager">
                <button class="pager-btn" (click)="page = page - 1" [disabled]="page === 1">¬´ Anterior</button>
                <span class="text-sm">P√°gina {{ page }}</span>
                <button class="pager-btn" (click)="page = page + 1"
                    [disabled]="(filteredCustomersList.length || 0) <= (page * pageSize)">
                    Siguiente ¬ª
                </button>
            </div>
        </div>
    </ng-container>

    <ng-template #emptyCustomers>
        <div class="app-card">
            <div class="app-card-body text-center text-gray-500">
                No hay datos para mostrar
            </div>
        </div>
    </ng-template>

    <!-- MODAL -->
    <div *ngIf="mostrarModal" class="app-modal-backdrop">
        <div class="app-modal">
            <button class="app-modal-close" (click)="cerrarModal()">√ó</button>

            <div class="app-card-body">
                <h3 class="text-lg font-semibold mb-4">
                    {{ clienteEditando ? 'Editar Cliente' : 'Nuevo Cliente' }}
                </h3>

                <form [formGroup]="clienteForm" (ngSubmit)="guardarCliente()" class="grid gap-4 text-sm">

                    <div>
                        <label class="block mb-1 font-medium">Nombre / Raz√≥n Social</label>
                        <input type="text" class="input" formControlName="nombre"
                            (input)="clienteForm.patchValue({ nombre: ($any($event.target)?.value || '').toUpperCase() }, { emitEvent: false })" />
                        <div *ngIf="submitted && f['nombre'].invalid" class="text-red-600 text-xs mt-1">Campo requerido.
                        </div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Tipo de Identificaci√≥n</label>
                        <select class="select" formControlName="tipo_identificacion">
                            <option *ngFor="let item of identificationTypes" [value]="item.value"> {{ item.label }}
                            </option>

                        </select>
                        <div *ngIf="submitted && f['tipo_identificacion'].invalid" class="text-red-600 text-xs mt-1">
                            Seleccione un tipo v√°lido.
                        </div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Identificaci√≥n</label>
                        <input class="input" type="text" [attr.maxlength]="getMaxLength()"
                            formControlName="num_identificacion" />
                        <div *ngIf="submitted && f['num_identificacion'].invalid" class="text-red-600 text-xs mt-1">
                            Campo requerido.
                        </div>
                        <div *ngIf="submitted && f['num_identificacion'].errors?.['cedulaInvalida']"
                            class="text-red-600 text-xs mt-1">
                            La c√©dula debe tener 10 caracteres.
                        </div>
                        <div *ngIf="submitted && f['num_identificacion'].errors?.['rucInvalido']"
                            class="text-red-600 text-xs mt-1">
                            El RUC debe tener 13 caracteres.
                        </div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Email</label>
                        <input class="input" type="email" formControlName="correo" />
                        <div *ngIf="submitted && f['correo'].invalid" class="text-red-600 text-xs mt-1">Email inv√°lido.
                        </div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Tel√©fono</label>
                        <input class="input no-spinner" type="number" maxlength="10" formControlName="telefono" />
                        <div *ngIf="submitted && f['telefono'].invalid" class="text-red-600 text-xs mt-1">Tel√©fono
                            inv√°lido.</div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Direcci√≥n</label>
                        <input class="input" type="text" formControlName="direccion" />
                        <div *ngIf="submitted && f['direccion'].invalid" class="text-red-600 text-xs mt-1">Direcci√≥n
                            inv√°lida.</div>
                    </div>

                    <div class="flex items-center gap-2">
                        <input id="isactive" type="checkbox" formControlName="isactive" />
                        <label for="isactive">Activo</label>
                    </div>

                    <div class="flex justify-end gap-2 pt-2">
                        <button type="button" class="btn btn-outline" (click)="cerrarModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>

        </div>
    </div>

</div>