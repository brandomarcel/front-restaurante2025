<div class="container bg-primary-foreground mx-auto my-8 px-4 p-3 text-xs ">

  <!-- Título + botón -->
  <div class="mb-4 flex justify-between text-xs">
    <div class="inline-block">
      <h2 class="text-2xl font-semibold text-primary">Productos Mas Vendidos</h2>
      <div class="text-muted-foreground space-x-1 text-xs font-medium">
        <span class="hover:text-primary">Filtrado por fecha</span>
      </div>
    </div>
    <div class="inline-block space-x-4">
      <button (click)="exportarExcel()" class="bg-green-600 text-white rounded-md px-4 py-2.5 text-xs font-semibold hover:bg-green-700 transition">
        Descargar Excel
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="mb-4 flex flex-col md:flex-row md:items-end md:space-x-4 space-y-2 md:space-y-0 text-xs">
    <div>
      <label class="block text-xs font-medium text-gray-700">Desde</label>
      <input type="date" [(ngModel)]="fromDate"
        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-xs focus:ring-blue-500 focus:border-blue-500" />
    </div>
    <div>
      <label class="block text-xs font-medium text-gray-700">Hasta</label>
      <input type="date" [(ngModel)]="toDate"
        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-xs focus:ring-blue-500 focus:border-blue-500" />
    </div>
    <div>
      <button (click)="cargarDatos()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition mt-1 md:mt-0">
        Buscar
      </button>
    </div>
  </div>

  <!-- Cargando -->
  <div *ngIf="loading" class="text-blue-600 font-medium mb-2">Cargando...</div>

  <!-- Tabla -->
  <ng-container *ngIf="!loading && data.length > 0; else emptyData">
    <!-- Selector de página -->
    <div class="flex items-center justify-between mb-3 text-xs">
      <div class="flex gap-2 items-center">
        <span class="text-gray-700">Mostrar:</span>
        <button *ngFor="let size of [20, 50, 100]" (click)="setPageSize(size)" [ngClass]="{
          'bg-blue-600 text-white': pageSize === size,
          'bg-white text-gray-700 border': pageSize !== size
        }" class="px-3 py-1 rounded border border-gray-300 hover:bg-blue-100 transition">
          {{ size }}
        </button>
        <button (click)="setPageSize(data.length)" [ngClass]="{
          'bg-blue-600 text-white': pageSize === data.length,
          'bg-white text-gray-700 border': pageSize !== data.length
        }" class="px-3 py-1 rounded border border-gray-300 hover:bg-blue-100 transition">
          Todos
        </button>
      </div>
      <div class="text-gray-600">
        Página <strong>{{ page }}</strong> de <strong>{{ totalPages }}</strong>
      </div>
    </div>

    <!-- Tabla con scroll horizontal -->
    <div class="overflow-x-auto rounded-lg shadow-md overflow-auto">
      <table class="min-w-full divide-y divide-gray-200 bg-white text-xs">
        <thead class="bg-gray-100 sticky top-0 z-10">
          <tr>
            <th *ngFor="let col of columns" class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">
              {{ col.label }}
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <tr *ngFor="let row of data | paginate: { itemsPerPage: pageSize, currentPage: page }" class="hover:bg-gray-50 transition">
            <td *ngFor="let col of columns" class="px-4 py-2 text-gray-800 whitespace-nowrap">
              {{ row[col.fieldname] }}
            </td>
          </tr>
        </tbody>
      </table>

      <pagination-controls
        (pageChange)="page = $event"
        class="mt-4 flex justify-center">
      </pagination-controls>
    </div>
  </ng-container>

  <!-- Sin datos -->
  <ng-template #emptyData>
    <p class="text-center text-gray-500 mt-4">No se encontraron datos.</p>
  </ng-template>
</div>
