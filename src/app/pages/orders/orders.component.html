<div class="flex flex-col">

  <!-- Header -->
  <div class="app-page-header">
    <div>
      <h2 class="app-page-title">Ã“rdenes</h2>
      <div class="app-page-subtle space-x-1">
        <span># Registros:</span>
        <span class="text-foreground font-semibold">{{ totalOrders }}</span>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="toolbar">
    <div class="flex flex-col sm:flex-row gap-2 w-full">
      <!-- Texto: NÂ° orden / cliente / cÃ©dula / tipo / estado -->
      <input class="input" type="text" [(ngModel)]="searchTerm" (ngModelChange)="actualizarOrdenesFiltradas()"
        placeholder="Buscar por #orden, cliente, cÃ©dula, tipo o estado SRI..." />

      <!-- Tipo -->
      <select class="select" [(ngModel)]="tipoFiltro" (ngModelChange)="actualizarOrdenesFiltradas()">
        <option value="">Todos los tipos</option>
        <option value="Factura">Factura</option>
        <option value="Nota Venta">Nota de venta</option>
      </select>

      <!-- AnulaciÃ³n -->
      <!-- <select class="select" [(ngModel)]="anulacionFiltro" (ngModelChange)="actualizarOrdenesFiltradas()">
        <option value="">Todas (incluye anuladas)</option>
        <option value="soloAnuladas">Solo anuladas</option>
        <option value="excluirAnuladas">Excluir anuladas</option>
      </select> -->
    </div>

    <div class="flex gap-2">
      <app-button (click)="limpiarFiltros()" full impact="bold" tone="light" shape="rounded" size="small">
        Limpiar
      </app-button>
    </div>
  </div>

  <!-- Tabla de Ã³rdenes -->
  <ng-container *ngIf="ordersFiltradosList.length > 0; else emptyOrders">
    <div class="app-table-wrap">
      <table class="app-table">
        <thead class="app-thead">
          <tr>
            <th class="app-th">NÂ° Orden</th>
            <th class="app-th">Fecha</th>
            <th class="app-th">Cliente</th>
            <th class="app-th">IVA</th>
            <th class="app-th">Total</th>
            <th class="app-th">Tipo</th>
            <th class="app-th last:text-center">Estado SRI</th>
            <th class="app-th last:text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let order of ordersFiltradosList" class="app-tr text-xs">
            <td class="app-td">{{ order.name }}</td>
            <td class="app-td">{{ order.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
            <td class="app-td">
              {{ order.customer?.fullName || order.customer?.nombre || 'â€”' }}
            </td>
            <td class="app-td">
              {{ order.iva | currency:'USD':'symbol':'1.2-2' }}
            </td>
            <td class="app-td font-semibold">
              {{ order.total | currency:'USD':'symbol':'1.2-2' }}
            </td>
            <td class="app-td">
              <span class="badge badge-gray">{{ order.type }}</span>
            </td>
            <td class="app-td text-center">
              <span class="badge" [ngClass]="{
                  'badge-green': order.sri?.status === 'AUTORIZADO',
                  'badge-red': order.sri?.status === 'Rejected' || order.sri?.status === 'Error',
                  'badge-yellow': order.sri?.status !== 'AUTORIZADO'
                                   && order.sri?.status !== 'Rejected'
                                   && order.sri?.status !== 'Error'
                }">
                {{
                order.sri?.status === 'AUTORIZADO' ? 'AUTORIZADO' :
                order.sri?.status === 'Rejected' ? 'Rechazada' :
                order.sri?.status === 'Error' ? 'Error' :
                order.sri?.status === 'Queued' ? 'En cola' :
                order.sri?.status === 'Processing'? 'En proceso' :
                order.sri?.status === 'Draft' ? 'Borrador' :
                (order.sri?.status || 'Sin factura')
                }}
              </span>
            </td>

            <td class="app-td text-center">
              <div class="inline-flex gap-2">
               <button class="btn btn-outline" [routerLink]="['/dashboard/orders', order.name]">ðŸ”Ž Abrir</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- PaginaciÃ³n -->
      <div class="pager">
        <button class="pager-btn" (click)="prevPage()" [disabled]="page === 1">Â« Anterior</button>
        <span class="text-sm">PÃ¡gina {{ page }} de {{ totalPages }}</span>
        <button class="pager-btn" (click)="nextPage()" [disabled]="page === totalPages">Siguiente Â»</button>
      </div>
    </div>
  </ng-container>

  <ng-template #emptyOrders>
    <div class="app-card">
      <div class="app-card-body text-center text-gray-500">
        No hay Ã³rdenes para mostrar.
      </div>
    </div>
  </ng-template>

</div>